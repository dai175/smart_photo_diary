# ホーム画面タブ統一実装チェックリスト

## Phase 1: 基盤準備 (1-2日)

### 📋 分析・設計
- [x] 既存コードの詳細分析完了
  - [x] `home_screen.dart` の TabController 使用箇所の特定
  - [x] `home_content_widget.dart` のタブ関連ロジック特定
  - [x] `PhotoSelectionController` の使用状況確認
- [x] 新しいタイムライン用データ構造設計
  - [x] 日付グルーピング仕様の詳細化
  - [x] 写真取得ロジックの統一仕様作成
- [x] FAB統合仕様の詳細設計完了

### 🧪 テスト環境準備
- [x] 既存テストケースの実行・確認
  - [x] `fvm flutter test` の成功確認
  - [x] カバレッジレポートの取得
- [x] 変更対象ファイルのテスト追加検討
- [x] テスト用のモックデータ準備

## Phase 2: 基本統合実装 (2-3日)

### 🏗️ コアロジック実装
- [ ] タイムライン用の新しいウィジェット作成
  - [ ] `TimelinePhotoWidget` の基本実装
  - [ ] `CustomScrollView` + `Sliver` ベース構造
  - [ ] 日付ヘッダー (`SliverPersistentHeader`) の実装
- [ ] 写真グルーピングロジック実装
  - [ ] `TimelineGroupingService` 作成
  - [ ] 今日/昨日/月単位のグルーピング機能
  - [ ] `getTimelineHeader()` メソッド実装
- [ ] 統一写真取得サービス
  - [ ] `UnifiedPhotoService` 作成（必要に応じて）
  - [ ] 既存の写真取得ロジックの活用

### 🎨 UI実装
- [ ] 日付ヘッダーコンポーネント
  - [ ] スティッキーヘッダーの実装
  - [ ] シンプルなテキスト表示（矢印なし）
  - [ ] Material Design 3 準拠のスタイリング
- [ ] 写真グリッドの統合
  - [ ] 既存 `OptimizedPhotoGridWidget` の活用
  - [ ] 遅延読み込み機能の維持
  - [ ] キャッシュ機能の継承
  - [ ] 日付制限時の視覚的フィードバック実装
    - [ ] 選択可能写真の通常表示維持
    - [ ] 選択不可写真の薄い表示（opacity: 0.3）
    - [ ] 選択状態変更時のアニメーション

## Phase 3: FAB統合 (1-2日)

### ⚡ FAB機能統合
- [ ] スマートFAB実装
  - [ ] 選択状態に応じたアイコン切り替え
  - [ ] アニメーション実装 (`AnimatedSwitcher`)
  - [ ] 色とアイコンの動的変更
- [ ] FABアクション統合
  - [ ] カメラ撮影処理の移植
  - [ ] 日記作成処理の移植
  - [ ] エラーハンドリングの実装
- [ ] tooltip実装
  - [ ] 選択枚数の動的表示
  - [ ] アクセシビリティ対応

### 📱 レスポンシブ対応
- [ ] 画面サイズ対応の確認
- [ ] SafeArea の適切な処理
- [ ] FABの位置調整

## Phase 4: 既存機能削除 (1日)

### 🗑️ 不要コード削除
- [ ] タブ関連の削除
  - [ ] `TabController` の削除
  - [ ] `_tabController` 関連メソッドの削除
  - [ ] タブ切り替えロジックの削除
- [ ] 最近の日記セクション削除
  - [ ] `_buildRecentDiariesSection` の削除
  - [ ] `RecentDiariesWidget` 関連処理の削除
  - [ ] 関連する状態管理の削除
- [ ] 過去タブ特有機能の削除
  - [ ] カレンダー表示関連コードの削除
  - [ ] プラン制限表示ロジックの削除
  - [ ] `PastPhotoCalendarWidget` の削除（使用されていない場合）

### 🧹 リファクタリング
- [ ] 不要なインポートの削除
- [ ] 使用されていない変数・メソッドの削除
- [ ] コメントの更新
- [ ] ファイル名の見直し（必要に応じて）

## Phase 5: 統合・テスト (2-3日)

### 🔗 統合実装
- [ ] `home_screen.dart` の更新
  - [ ] 新しいタイムラインウィジェットの統合
  - [ ] 既存のナビゲーション処理の維持
  - [ ] 権限処理の統合
- [ ] `home_content_widget.dart` の大幅リファクタリング
  - [ ] タブ構造の完全削除
  - [ ] 新しいタイムライン表示への置き換え
  - [ ] プル・トゥ・リフレッシュの維持

### 🧪 包括的テスト
- [ ] 単体テスト
  - [ ] 新しいタイムライン関連のテスト作成
  - [ ] FABアクションのテスト
  - [ ] 日付グルーピングロジックのテスト
- [ ] ウィジェットテスト
  - [ ] UI表示の確認
  - [ ] インタラクションのテスト
  - [ ] アニメーションのテスト
  - [ ] 日付制限フィードバックのテスト
    - [ ] 選択時の薄い表示切り替え
    - [ ] 選択解除時の表示復帰
- [ ] 統合テスト
  - [ ] エンドツーエンドの動作確認
  - [ ] 権限関連の動作確認
  - [ ] エラーケースのテスト

## Phase 6: 品質保証・最適化 (1-2日)

### 🔍 品質チェック
- [ ] コード品質確認
  - [ ] `fvm flutter analyze` の実行・修正
  - [ ] `fvm dart format .` の実行
  - [ ] lint ルールの準拠確認
- [ ] パフォーマンステスト
  - [ ] 大量写真でのスクロール性能確認
  - [ ] メモリ使用量の測定
  - [ ] 画像読み込み性能の確認
- [ ] アクセシビリティチェック
  - [ ] スクリーンリーダー対応
  - [ ] キーボードナビゲーション
  - [ ] コントラスト比の確認

### 📊 最終確認
- [ ] 各プラン（Basic/Premium）での動作確認
- [ ] 権限パターンでの動作確認
  - [ ] 写真ライブラリ権限拒否
  - [ ] Limited Access
  - [ ] Full Access
- [ ] エラー処理の確認
  - [ ] ネットワークエラー
  - [ ] 写真アクセスエラー
  - [ ] AI生成エラー

## Phase 7: リリース準備 (1日)

### 📝 ドキュメント更新
- [ ] `CLAUDE.md` の更新（該当する場合）
- [ ] コード内コメントの更新
- [ ]変更ログの作成

### 🚀 デプロイメント準備
- [ ] 最終テスト実行 (`fvm flutter test`)
- [ ] ビルド確認 (`fvm flutter build ios --release`)
- [ ] サンドボックス環境でのテスト
- [ ] プロダクション環境への影響評価

---

## ⚠️ 重要な注意事項

### 品質管理
- **各Phaseで必ずテストを実行**し、100%成功を維持する
- **`fvm flutter analyze`** で警告・エラーゼロを維持する
- **既存機能に影響を与えない**ことを各段階で確認する

### 実装指針
- **段階的実装**: 一度に大きな変更をせず、小さなステップで進める
- **既存コード活用**: 可能な限り既存の`OptimizedPhotoGridWidget`等を再利用
- **エラーハンドリング**: 各機能で適切なエラー処理を実装

### 確認項目
- [ ] 全フェーズ完了後、既存の800+テストが100%成功
- [ ] メモリリークの発生なし
- [ ] UI/UXの一貫性維持
- [ ] アクセシビリティガイドライン準拠

---

## 📋 進捗管理

各チェックボックスは実装完了時にチェックし、問題が発生した場合は詳細を記録してください。

**開始日**: 2025年1月15日  
**予定完了日**: 2025年1月22日  
**実際の完了日**: Phase 1完了 (2025年1月15日)