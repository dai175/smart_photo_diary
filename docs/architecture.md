# Smart Photo Diary アーキテクチャ概要

---

## 目的
その日に撮影された写真を自動で取得し、AIが日記を生成することで、ユーザーが簡単に思い出を記録できるアプリ。すべてのデータは端末ローカルに安全に保存される。

## 全体構成

```mermaid
flowchart TD
    subgraph UI[UIレイヤ]
        A[ホーム画面] --> B[日記一覧画面]
        B --> C[統計画面]
        C --> D[設定画面]
    end
    subgraph APP[アプリケーションロジック]
        E[写真自動取得]
        F[写真→テキスト生成(AI)]
        G[日記データ管理]
        H[位置情報取得]
        I[気分分析]
    end
    subgraph INFRA[インフラ・ストレージ]
        J[Hive DB]
        K[ファイルシステム]
    end
    
    E -- 新規写真取得 --> A
    A -- 写真選択 --> F
    F -- 生成テキスト --> G
    H -- 位置情報 --> F
    G -- 日記データ --> B
    G -- 日記データ --> C
    G -- 保存/取得 --> J
    G -- 画像参照 --> K
    E -- 画像保存 --> K
    G -- 日記データ --> I
    I -- 気分タグ --> G
```

## レイヤ構成

### UIレイヤ
- **ホーム画面**: 新規写真の表示と選択、日記作成ボタン、最近の日記リスト
- **日記一覧画面**: 日記の一覧表示、検索、フィルター機能
- **統計画面**: 日記の時系列分析、気分分析、写真トレンド
- **設定画面**: アプリ設定、データ管理、プライバシー設定

### アプリケーションロジック
- **写真自動取得**: その日に撮影された写真を自動で取得（photo_managerパッケージ使用）
- **AIテキスト生成**: 写真から日記テキストを生成（tflite_flutter）
- **日記データ管理**: 日記の保存、取得、編集（hive）
- **位置情報取得**: 写真の位置情報を取得（geolocator）
- **気分分析**: 日記テキストから気分を分析しタグ付け（tflite_flutter）

### インフラ・ストレージ
- **Hive DB**: 日記本文、メタデータ、タグなどの構造化データ保存
- **ファイルシステム**: 画像ファイルの保存と参照（path_provider）

## データフロー例
1. ユーザーが写真を選択
2. 画像がAI推論に渡され日記テキスト生成
3. 必要に応じて位置情報も取得し、日記データとして保存
4. 日記一覧・カレンダー・統計画面でローカルDBからデータ取得

## セキュリティ・プライバシー
- データはすべて端末内（Hive/ファイル）に保存
- クラウド送信や外部API連携は行わない（MVP範囲）

## 今後の拡張ポイント（例）
- 状態管理の導入（Riverpod等）
- 画像加工・編集機能
- 外部ストレージ/クラウド連携（オプション）
- マルチプラットフォームUI最適化
